(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const K=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,t,{onPreviewPicture:o,onLikeIcon:n,onDeleteCard:r,onInfoClick:c})=>{const s=K(),i=s.querySelector(".card__like-button"),d=s.querySelector(".card__control-button_type_delete"),S=s.querySelector(".card__image"),v=s.querySelector(".card__like-count"),B=s.querySelector(".card__control-button_type_info");S.src=e.link,S.alt=e.name,s.querySelector(".card__title").textContent=e.name,v&&(v.textContent=e.likes?e.likes.length:0);const M=e.likes&&e.likes.some(z=>z._id===t);return M&&i.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==t&&d.remove(),n&&i.addEventListener("click",()=>n(e._id,M,i,v)),r&&e.owner&&e.owner._id===t&&d.addEventListener("click",()=>r(e._id,s)),o&&S.addEventListener("click",()=>o({name:e.name,link:e.link})),c&&B&&B.addEventListener("click",()=>c(e._id)),s},A=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",A)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",A)},G=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})},Q=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},U=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},X=(e,t,o)=>{const n=t.dataset.errorMessage;if(t.validity.valid)U(e,t,o);else{let c;t.validity.patternMismatch&&n?c=n:c=t.validationMessage,Q(e,t,c,o)}},Y=e=>e.some(t=>!t.validity.valid),F=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},Z=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},w=(e,t,o)=>{Y(e)?F(t,o):Z(t,o)},D=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);w(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{X(e,r,t),w(o,n,t)})})},g=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{U(e,r,t)}),F(n,t)},ee=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{D(o,e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"ca8b4a27-88cf-4bc2-8d34-b6c54448354a","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),te=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(u),N=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(u),oe=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(u),ne=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(u),re=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(u),ce=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(u),se=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(u),O=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),y=L.querySelector(".popup__form"),W=y.querySelector(".popup__input_type_name"),V=y.querySelector(".popup__input_type_description"),q=document.querySelector(".popup_type_new-card"),a=q.querySelector(".popup__form"),le=a.querySelector(".popup__input_type_card-name"),ie=a.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),P=C.querySelector(".popup__image"),ae=C.querySelector(".popup__caption"),ue=document.querySelector(".profile__edit-button"),de=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_edit-avatar"),_=x.querySelector(".popup__form"),pe=_.querySelector(".popup__input");let b=null;const H=({name:e,link:t})=>{P.src=t,P.alt=e,ae.textContent=e,f(C)},m=(e,t,o,n)=>{t?(e.textContent=n,e.disabled=!0):(e.textContent=o,e.disabled=!1)},_e=e=>{e.preventDefault();const t=y.querySelector(".popup__button"),o=t.textContent;m(t,!0,o,"Сохранение..."),oe({name:W.value,about:V.value}).then(n=>{k.textContent=n.name,E.textContent=n.about,p(L)}).catch(n=>{console.log(n)}).finally(()=>{m(t,!1,o,"Сохранение...")})},me=e=>{e.preventDefault();const t=_.querySelector(".popup__button"),o=t.textContent;m(t,!0,o,"Сохранение..."),ne({avatar:pe.value}).then(n=>{I.style.backgroundImage=`url(${n.avatar})`,_.reset(),p(x)}).catch(n=>{console.log(n)}).finally(()=>{m(t,!1,o,"Сохранение...")})},fe=e=>{e.preventDefault();const t=a.querySelector(".popup__button"),o=t.textContent;m(t,!0,o,"Создание..."),re({name:le.value,link:ie.value}).then(n=>{O.prepend($(n,b,{onPreviewPicture:H,onLikeIcon:J,onDeleteCard:j,onInfoClick:R})),a.reset(),p(q)}).catch(n=>{console.log(n)}).finally(()=>{m(t,!1,o,"Создание...")})},j=(e,t)=>{ce(e).then(()=>{t.remove()}).catch(o=>{console.log(o)})},J=(e,t,o,n)=>{se(e,t).then(r=>{o.classList.toggle("card__like-button_is-active"),n&&(n.textContent=r.likes?r.likes.length:0)}).catch(r=>{console.log(r)})},ye=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),T=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},he=e=>{const o=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0),n=o.querySelector(".popup__list-item");return n.textContent=e.name,n.style.backgroundImage=`url(${e.avatar})`,o},R=e=>{const t=document.querySelector(".popup_type_info"),o=t.querySelector(".popup__title"),n=t.querySelector(".popup__info"),r=t.querySelector(".popup__text"),c=t.querySelector(".popup__list");n.innerHTML="",c.innerHTML="",N().then(s=>{const i=s.find(d=>d._id===e);if(!i){console.log("Карточка не найдена");return}o.textContent=i.name,n.append(T("Автор:",i.owner.name),T("Дата создания:",ye(new Date(i.createdAt)))),i.likes&&i.likes.length>0?(r.textContent=`Лайкнули (${i.likes.length}):`,i.likes.forEach(d=>{c.append(he(d))})):r.textContent="Пока никто не лайкнул",f(t)}).catch(s=>{console.log(s)})},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ee(h);y.addEventListener("submit",_e);a.addEventListener("submit",fe);_.addEventListener("submit",me);ue.addEventListener("click",()=>{W.value=k.textContent,V.value=E.textContent,g(y,h),f(L)});I.addEventListener("click",()=>{_.reset(),g(_,h),f(x)});de.addEventListener("click",()=>{a.reset(),g(a,h),f(q)});const Se=document.querySelectorAll(".popup");Se.forEach(e=>{G(e)});Promise.all([N(),te()]).then(([e,t])=>{b=t._id,k.textContent=t.name,E.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{O.append($(o,b,{onPreviewPicture:H,onLikeIcon:J,onDeleteCard:j,onInfoClick:R}))})}).catch(e=>{console.log(e)});
